name: Auto Create Geek Task Issue

on:
  push:
    paths:
      - "weeks/**/geek-task/task-brief.md"

jobs:
  create-issue:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Create GitHub Issue
        uses: actions/github-script@v7
        with:
          script: |
            const path = context.payload.head_commit.modified
              .find(p => p.includes("geek-task/task-brief.md"));

            if (!path) {
              console.log("No Geek Task update detected.");
              return;
            }

            const weekMatch = path.match(/week-(\d{2})/);
            const week = weekMatch ? weekMatch[1] : "XX";

            const title = `Geek Task (Week ${week})`;
            const body = `
## ðŸ“˜ Geek Task â€“ Week ${week}

A new Geek Task has been published or updated.

### ðŸ“‚ Task Location
\`${path}\`

### âœ… Student Instructions
- Read the task brief
- Implement using allowed tools only
- Submit inside your student folder
- Open a Pull Request

### ðŸŽ¯ Evaluation
Focus on logic, structure, and correct use of concepts.
`;

            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title,
              body,
              labels: ["geek-task", `week-${week}`]
            });
